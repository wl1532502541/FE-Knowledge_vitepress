# è·¨åŸŸ
## å‰è¨€
ä»â€œè·¨åŸŸâ€è¿™ä¸ªè¯å¼€å§‹ï¼Œå»ç†æ¸…è·¨åŸŸè¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œé€”å¾„åŒæºç­–ç•¥ï¼Œè·¨è¿‡document.domainï¼Œwindow.postMessageï¼ŒJSONPï¼ŒCORSç­‰ï¼Œå…ˆæ”¾è‹¥å¹²ä¸ªé—®é¢˜ï¼Œå¸Œæœ›çœ‹å®Œæ–‡ç« çš„ä½ å¯ä»¥ç­”ä¸Šæ¥ã€‚

1. èƒ½è¯´è¯´è·¨åŸŸå—ï¼Ÿ
1. èƒ½è¯´è¯´åŒæºç­–ç•¥å—ï¼Ÿ
1. ä¸ºä»€ä¹ˆè¦åŒæºç­–ç•¥ï¼Œå®ƒé™åˆ¶äº†ä»€ä¹ˆï¼Ÿ
1. ä½ çŸ¥é“å“ªäº›è·¨åŸŸæ–¹æ¡ˆå‘¢ï¼Ÿ
1. æœ‰å…³cookieçš„è·¨åŸŸæ€ä¹ˆå®ç°ï¼Ÿ
1. èƒ½å…·ä½“è¯´è¯´JSONPå—ï¼Ÿè¿”å›ä»€ä¹ˆæ•°æ®å‘¢ï¼Œå‰ç«¯æ€ä¹ˆå¤„ç†å‘¢ï¼ŸçŸ¥é“ä»€ä¹ˆåŸç†å—ï¼Ÿå®ç°è¿‡å—ï¼ŸJSONPæœåŠ¡å™¨ç«¯å®ç°è¿‡å—ï¼Ÿ
1. postMessage äº†è§£å—ï¼Ÿæ€ä¹ˆä½¿ç”¨ï¼Ÿéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿï¼ˆå®‰å…¨æ–¹é¢ï¼‰
1. ä»£ç†äº†è§£è¿‡å—ï¼Ÿç”¨è¿‡å“ªäº›ä»£ç†æ–¹æ¡ˆå‘¢ä¸ï¼Ÿæ€ä¹ˆåœ¨é¡¹ç›®ä¸­ç”¨å‘¢ï¼Ÿ
1. corså¯ä»¥å…·ä½“è¯´ä¸€ä¸ªç®€å•è¯·æ±‚å’Œéç®€å•è¯·æ±‚å—ï¼Ÿå…·ä½“è¿‡ç¨‹è¯´ä¸€ä¸‹ï¼Ÿé¡¹ç›®ä¸­æ€ä¹ˆä½¿ç”¨ï¼Ÿ

æ–‡ç« å¯èƒ½æœ‰äº›åœ°æ–¹å†™çš„ä¸å½“å’Œä¸å…¨çš„åœ°æ–¹ï¼Œæ¬¢è¿è¯„è®ºåŒºç»™æˆ‘å»ºè®®ï¼Œæ„Ÿè°¢~~ ğŸ¤ğŸ¤ğŸ¤
ä¹Ÿå¸Œæœ›é‡Œé¢çš„çŸ¥è¯†ç‚¹æœ‰å“ªé‡Œä¸æ¸…æ¥šçš„ï¼Œä½ å¯ä»¥è‡ªå·±å¯ä»¥èŠ±æ—¶é—´å»æ•´æ˜ç™½æ›´å¥½ï¼ŒåŠ æ²¹å‘€ğŸ˜Š
è¿™æ¬¡å°±ä¸æ”¾å¯¼å›¾å•¦ï¼Œå³è¾¹ç›®å½•å¾ˆæ¸…æ¥š~~

## 1ã€è®²ä¸€ä¸‹è·¨åŸŸæ˜¯ä»€ä¹ˆï¼Ÿ
ä¸€ä¸ªæºåŠ è½½çš„æ–‡æ¡£æˆ–è€…è„šæœ¬å’Œæ¥è‡ªå¦ä¸€ä¸ªæºçš„æ–‡æ¡£å’Œè„šæœ¬ç­‰èµ„æºè¿›è¡Œäº¤äº’ï¼ˆä¹Ÿå°±æ˜¯ä¸æ»¡è¶³åŒæºç­–ç•¥çš„ä¸¤ä¸ªæºä¹‹é—´è¿›è¡Œä¸€äº›äº¤äº’ï¼‰ï¼Œå°±æ˜¯è·¨åŸŸã€‚
æ‰€ä»¥ä½ éœ€è¦æ¸…æ¥šçš„æ˜¯åŒæºç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿå®ƒä¸ºä»€ä¹ˆå‡ºç°ï¼Ÿå®ƒåˆé™åˆ¶äº†ä»€ä¹ˆï¼Ÿ  å¾€ä¸‹çœ‹å§ï¼š
## 2ã€åŒæºç­–ç•¥
### 2.1ã€ åŒæºç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ
æ‰€è°“"åŒæº"æŒ‡çš„æ˜¯"ä¸‰ä¸ªç›¸åŒ"ã€‚

- åè®®ç›¸åŒ
- åŸŸåç›¸åŒ
- ç«¯å£ç›¸åŒ

ä¸¾ä¸ªæ —å­:
`[http://www.jingda.com/dir/page.html](http://www.jingda.com/dir/page.html)`è¿™ä¸ªç½‘å€ï¼Œåè®®æ˜¯`http://`ï¼ŒåŸŸåæ˜¯`www.jingda.com`ï¼Œç«¯å£æ˜¯80ï¼ˆé»˜è®¤ç«¯å£å¯ä»¥çœç•¥ï¼‰ã€‚æ¥çœ‹çœ‹ä¸‹é¢æ”¹ç¼–çš„å“ªäº›æ˜¯åŒæºå“ªäº›æ˜¯ä¸åŒæºï¼š

- `[http://www.jingda.com/dir2/other.html](http://www.jingda.com/dir2/other.html)`ï¼šåŒæº
- `[http://jingda1.com/dir/other.html](http://jingda1.com/dir/other.html)`ï¼šä¸åŒæºï¼ˆåŸŸåä¸åŒï¼‰
- `[http://v2.www.jingda.com/dir/other.html](http://v2.www.jingda.com/dir/other.html)`ï¼šä¸åŒæºï¼ˆåŸŸåä¸åŒï¼‰
- `[http://www.jingda.com:81/dir/other.html](http://www.jingda.com:81/dir/other.html)`ï¼šä¸åŒæºï¼ˆç«¯å£ä¸åŒï¼‰
- `[https://www.jingda.com/dir/page.html](https://www.jingda.com/dir/page.html)`ï¼šä¸åŒæºï¼ˆåè®®ä¸åŒï¼‰
### 2.2ã€ ä¸ºä»€ä¹ˆéœ€è¦åŒæºç­–ç•¥ï¼Ÿ
åŒæºæ”¿ç­–çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†ä¿è¯ç”¨æˆ·ä¿¡æ¯çš„å®‰å…¨ï¼Œé˜²æ­¢æ¶æ„çš„ç½‘ç«™çªƒå–æ•°æ®ã€‚å®ƒèƒ½å¸®åŠ©é˜»éš”æ¶æ„æ–‡æ¡£ï¼Œå‡å°‘å¯èƒ½è¢«æ”»å‡»çš„åª’ä»‹ã€‚ å‡è®¾å°æ˜åŒå­¦åœ¨Aé“¶è¡Œçš„å®˜ç½‘è¿›è¡Œäº†ç™»å½•ï¼Œä¹‹åä»–åˆå»æµè§ˆäº†å…¶ä»–ç½‘ç«™ï¼Œå¦‚æœå…¶ä»–ç½‘ç«™å¯ä»¥è¯»å–Aé“¶è¡Œå®˜ç½‘çš„cookieï¼Œé‚£ä¹ˆå°æ˜åœ¨Aé“¶è¡Œçš„ç™»å½•ä¿¡æ¯å’Œå…¶ä»–å­˜æ¬¾è®°å½•ç­‰éƒ½ä¼šè¢«æ³„éœ²ï¼Œå°†æ˜¯ä¸€ä»¶éå¸¸å±é™©çš„æƒ…å†µã€‚
è€Œcookieçš„è®¿é—®é™åˆ¶åªæ˜¯åŒæºç­–ç•¥é™åˆ¶çš„ä¸€ç§æƒ…å†µï¼Œä¸‹é¢æˆ‘ä»¬ä»‹ç»ä¸€ä¸‹å…¶ä»–çš„ã€‚
### 2.3ã€ åŒæºç­–ç•¥å¸¦æ¥äº†ä»€ä¹ˆè®¿é—®é™åˆ¶ï¼Ÿ

- è·¨æºæ•°æ®å­˜å‚¨è®¿é—®ï¼šè®¿é—®å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­çš„æ•°æ®ï¼Œå¦‚ localStorage å’Œ IndexedDBï¼Œæ˜¯ä»¥æºè¿›è¡Œåˆ†å‰²ï¼›Cookies  ä½¿ç”¨ä¸åŒçš„æºå®šä¹‰æ–¹å¼ã€‚æ¯ä¸ªæºéƒ½æ‹¥æœ‰è‡ªå·±å•ç‹¬çš„å­˜å‚¨ç©ºé—´ï¼Œä¸€ä¸ªæºä¸­çš„ JavaScript è„šæœ¬ä¸èƒ½å¯¹å±äºå…¶å®ƒæºçš„æ•°æ®è¿›è¡Œè¯»å†™æ“ä½œã€‚
- è·¨æºè„šæœ¬APIè®¿é—®ï¼šJavaScript çš„ API ä¸­ï¼Œå¦‚ iframe.contentWindowã€ window.parentã€window.open å’Œ window.opener å…è®¸æ–‡æ¡£é—´ç›´æ¥ç›¸äº’å¼•ç”¨ã€‚å½“ä¸¤ä¸ªæ–‡æ¡£çš„æºä¸åŒæ—¶ï¼Œè¿™äº›å¼•ç”¨æ–¹å¼å°†å¯¹ Window å’Œ Locationå¯¹è±¡çš„è®¿é—®æ·»åŠ é™åˆ¶ï¼Œ
- è·¨æºç½‘ç»œè®¿é—®ï¼šåŒæºç­–ç•¥æ§åˆ¶ä¸åŒæºä¹‹é—´çš„äº¤äº’ï¼Œä¾‹å¦‚åœ¨ä½¿ç”¨XMLHttpRequest æˆ–  æ ‡ç­¾æ—¶åˆ™ä¼šå—åˆ°åŒæºç­–ç•¥çš„çº¦æŸã€‚
## 3ã€è§£å†³è·¨åŸŸçš„å‡ ç§æ–¹æ³•ï¼Ÿ
å°†ä¸Šé¢ä¸‰ç§è®¿é—®é™åˆ¶ç®€åŒ–æˆä¸‹é¢çš„ä¸‰ç§è¡¨è¾¾ï¼š
ï¼ˆ1ï¼‰ Cookieã€LocalStorage å’Œ IndexDB æ— æ³•è¯»å–ã€‚
ï¼ˆ2ï¼‰ JavaScript çš„ API ä¸­çš„ä¸€äº›å¼•ç”¨ï¼Œæ— æ³•è·å¾—ã€‚ï¼ˆè¯¦è§ä¸Šï¼‰
ï¼ˆ3ï¼‰ AJAX  è¯·æ±‚ä¸èƒ½å‘é€ã€‚ï¼ˆä¹Ÿå°±æ˜¯æ— æ³•ä½¿ç”¨XMLHttpRequestï¼‰
ï¼ˆå› ä¸ºåœ¨ç½‘ä¸Šæœ‰å…³è·¨åŸŸçš„è§£å†³æ–¹æ¡ˆï¼Œå¯èƒ½æ˜¯æ¯”è¾ƒå¤šï¼Œä½†è¿™é‡Œæˆ‘æ˜¯æ ¹æ®ä¸Šé¢ä¸‰ç§é™åˆ¶ä¾æ¬¡ä»‹ç»ä¸€ä¸‹å¯èƒ½è¡Œå¾—é€šçš„è§£å†³æ–¹æ¡ˆï¼‰
### 3.1ã€ cookie -- document.domain
å½“æˆ‘ä»¬å°è¯•è§£å†³å› åŒæºç­–ç•¥ä¸‹ï¼Œæ— æ³•è®¿é—®cookieè¿™ç§æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©ï¼š

- 1ã€`æµè§ˆå™¨å…è®¸é€šè¿‡è®¾ç½®document.domainå…±äº« Cookieã€‚`æ¥è¾¾æˆæ•ˆæœã€‚ä½†æ˜¯ï¼Œ`ä¸¤ä¸ªç½‘é¡µä¸€çº§åŸŸåç›¸åŒï¼Œåªæ˜¯äºŒçº§åŸŸåä¸åŒ`æ‰å¯ä»¥è®¾ç½®ï¼Œé‚£ä»€ä¹ˆæ˜¯ä¸€çº§åŸŸåï¼Œä»€ä¹ˆæ˜¯äºŒçº§åŸŸåå‘¢ï¼Ÿ

ä¸¾ä¸ªæ —å­ï¼š Aç½‘é¡µï¼š`[http://w1.jingda.com/a.html](http://w1.jingda.com/a.html)`åœ¨è¿™ä¸ªç½‘é¡µåœ°å€ä¸­ï¼Œ`w1.jingda.com`è¿™éƒ¨åˆ†ç»Ÿç§°ä¸ºåŸŸåï¼Œ

- ä¸€çº§åŸŸåæ˜¯ç”±ä¸€ä¸ªåˆæ³•çš„å­—ç¬¦ä¸²+åŸŸååç¼€ç»„æˆï¼Œæ‰€ä»¥ï¼Œjingda.comè¿™ç§å½¢å¼çš„åŸŸåæ‰æ˜¯ä¸€çº§åŸŸåï¼Œjingdaæ˜¯åŸŸåä¸»ä½“ï¼Œ.comã€.netä¹Ÿæ˜¯åŸŸååç¼€ã€‚
- äºŒçº§åŸŸåå®é™…å°±æ˜¯ä¸€çº§åŸŸåä¸‹é¢çš„ä¸»æœºåï¼Œé¡¾åæ€ä¹‰ï¼Œ`å®ƒæ˜¯åœ¨ä¸€çº§åŸŸåå‰é¢åŠ ä¸Šä¸€ä¸ªå­—ç¬¦ä¸²`ï¼Œæ¯”å¦‚w1.jingda.comï¼Œ

è§£é‡Šå®Œæ€æ ·çš„æƒ…å†µå¯ä»¥è®¾ç½®document.domainå…±äº« Cookieï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªå¦‚ä½•æ“ä½œï¼š
å‡è®¾æœ‰ä¸¤ä¸ªç½‘é¡µåœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä»–ä»¬çš„ä¸€çº§åŸŸåæ˜¯ç›¸åŒçš„ï¼ŒäºŒçº§åŸŸåçš„ä¸åŒçš„ï¼š
Aç½‘é¡µï¼š`[http://w1.jingda.com/a.html](http://w1.jingda.com/a.html)`
Bç½‘é¡µï¼š`[http://w2.jingda.com/b.html](http://w2.jingda.com/b.html)`
é‚£ä¹ˆåªè¦è®¾ç½®ç›¸åŒçš„document.domainï¼Œä¸¤ä¸ªç½‘é¡µå°±å¯ä»¥å…±äº«Cookieã€‚
```
document.domain = 'example.com';
å¤åˆ¶ä»£ç 
```
Aç½‘é¡µé€šè¿‡è„šæœ¬è®¾ç½®ä¸€ä¸ª Cookieã€‚
```
document.cookie = "test1=hello";
å¤åˆ¶ä»£ç 
```
Bç½‘é¡µå°±å¯ä»¥è¯»åˆ°è¿™ä¸ª Cookieã€‚
```
var allCookie = document.cookie;
å¤åˆ¶ä»£ç 
```
2ã€æœåŠ¡å™¨ä¹Ÿå¯ä»¥åœ¨è®¾ç½®Cookieçš„æ—¶å€™ï¼ŒæŒ‡å®šCookieçš„æ‰€å±åŸŸåä¸ºä¸€çº§åŸŸåï¼Œæ¯”å¦‚.example.comã€‚
```
Set-Cookie: key=value; domain=.example.com; path=/
å¤åˆ¶ä»£ç 
```
è¿™æ ·çš„è¯ï¼ŒäºŒçº§åŸŸåå’Œä¸‰çº§åŸŸåä¸ç”¨åšä»»ä½•è®¾ç½®ï¼Œéƒ½å¯ä»¥è¯»å–è¿™ä¸ªCookieã€‚
è¿™é‡Œçš„è¯ï¼Œè¡¥å……ä¸€ä¸‹è®¾ç½®cookieçš„æ—¶å€™ï¼Œä¸€äº›å…¶ä»–çš„è®¾ç½®æ¥é™å®šå…¶å¯è®¿é—®æ€§ï¼š

1. Domain å’Œ Path æ ‡è¯†å®šä¹‰äº†Cookieçš„ä½œç”¨åŸŸï¼šå³å…è®¸ Cookie åº”è¯¥å‘é€ç»™å“ªäº›URLã€‚
1. Secureï¼šSecureå±æ€§æ˜¯è¯´å¦‚æœä¸€ä¸ªcookieè¢«è®¾ç½®äº†Secure=trueï¼Œé‚£ä¹ˆè¿™ä¸ªcookieåªèƒ½ç”¨httpsåè®®å‘é€ç»™æœåŠ¡å™¨ï¼Œç”¨httpåè®®æ˜¯ä¸å‘é€çš„ã€‚
1. HttpOnly ï¼šä½¿ç”¨ HttpOnly å±æ€§å¯é˜²æ­¢é€šè¿‡ JavaScript è®¿é—® cookie å€¼
1. SameSite Cookie å…è®¸æœåŠ¡å™¨è¦æ±‚æŸä¸ª cookie åœ¨è·¨ç«™è¯·æ±‚æ—¶ä¸ä¼šè¢«å‘é€ï¼Œä»è€Œå¯ä»¥é˜»æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»ï¼ˆCSRFï¼‰ã€‚

ä½ åº”è¯¥æ³¨æ„åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬åªæ˜¯å•å•è§£å†³äº†åœ¨æœ‰ä¸€äº›é™åˆ¶æ¡ä»¶ä¸‹çš„`è®¿é—®cookie`çš„é™åˆ¶ã€‚ä½†æ˜¯ä¸Šé¢è¿˜æåˆ°çš„`LocalStorage å’Œ IndexDB`æš‚æ—¶è¿˜æ²¡æœ‰è§£å†³ã€‚(ç­‰ä¸‹å†è¯´)
### 3.2ã€ APIè®¿é—® --  window.postMessage
postMessageæ˜¯html5æ–°å¢çš„ä¸€ä¸ªè§£å†³è·¨åŸŸçš„ä¸€ä¸ªæ–¹æ³•ï¼Œä¸ºäº†èƒ½è®©ä¸åŒæºä¸­æ–‡æ¡£è¿›è¡Œäº¤æµï¼Œå¯ä»¥ä½¿ç”¨ window.postMessageå®‰å…¨åœ°å®ç°è·¨æºé€šä¿¡ã€‚ï¼ˆå®‰å…¨æ˜¯æŒ‡åœ¨æ­£ç¡®çš„ä½¿ç”¨æƒ…å†µä¸‹ï¼‰ï¼Œè¿™
#### 3.2.1ã€window.postMessageçš„ä½¿ç”¨åœºæ™¯ï¼Ÿ
ä¸ªæˆ‘è‡ªå·±ä¹Ÿæ˜¯æ²¡æœ‰ç”¨è¿‡çš„ã€‚ä½¿ç”¨æ–¹æ³•å¤§å®¶å¯ä»¥å‚è€ƒè¿™ç¯‡[window.postMessageç”¨æ³•](https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_40650646%2Farticle%2Fdetails%2F81777398%3Futm_medium%3Ddistribute.pc_relevant.none-task-blog-2%257Edefault%257EBlogCommendFromBaidu%257Edefault-7.control%26dist_request_id%3D1328769.70653.16176908362791735%26depth_1-utm_source%3Ddistribute.pc_relevant.none-task-blog-2%257Edefault%257EBlogCommendFromBaidu%257Edefault-7.control)ä¸€ä¸ªæ¯”è¾ƒå°çš„æ¡ˆä¾‹
å› ä¸ºæ˜¯ä¸¤ä¸ªçª—å£é¡µé¢ä¹‹é—´çš„é€šä¿¡ï¼Œå› æ­¤æˆ‘ä»¬è¿™è¾¹å‡è®¾æˆ‘ä¸¤ä¸ªé¡µé¢ï¼ŒA,Bï¼Œç›®çš„æ˜¯åœ¨Bçª—å£ä¸­ç‚¹å‡»postMessageæŒ‰é’®ï¼Œèƒ½å¤Ÿåœ¨Aé¡µé¢æ”¶åˆ°å‘æ¥çš„æ¶ˆæ¯ã€‚ Aé¡µé¢ï¼š
```
<script>
  function test() {
    let op = window.open('b.html', '_blank'); 
    function receiveMessage(event) {
      console.log('event', event);
    }
    op.addEventListener("message", receiveMessage, false); 
  }
</script>
<body>
  <div>
    <button onClick="test()">open</button>
  </div>
</body>
å¤åˆ¶ä»£ç 
```
Bé¡µé¢ï¼š
```
<script>
  function post() {
    window.postMessage("hi there!", location.origin);
  }
  function receiveMessage(event) {
    console.log('event', event)
  }
  window.addEventListener("message", receiveMessage, false);
</script>
<body>
  <div>
    <button onClick="post()">postMessage</button>
  </div>
</body>
å¤åˆ¶ä»£ç 
```
æˆ‘å°±ç›´æ¥è¯´ä¸€ä¸‹å¤§æ¦‚çš„æ€è·¯äº†ï¼š é¦–å…ˆçœ‹çœ‹Bé¡µé¢ï¼š

1. åœ¨Bé¡µé¢æœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»è¿™ä¸ªæŒ‰é’®ä¼šè§¦å‘ä¸€ä¸ªæ–¹æ³•ï¼Œpost()
1. åœ¨post()æ–¹æ³•ä¸­ï¼Œwindow.postMessage("hi there!", location.origin)ï¼Œå‘é€åˆ°æ‰€æœ‰åŒæºçš„çª—å£ï¼Œæ³¨æ„ï¼Œå½“å‰çª—å£ä¹Ÿä¼šæ”¶åˆ°
1. ä¹‹åé€šè¿‡ window.addEventListener("message", receiveMessage, false)å»ç›‘å¬ï¼Œå¦‚æœæœ‰æ•°æ®ï¼Œå°±æ‰§è¡ŒreceiveMessage(),æŠŠæ•°æ®æ‰“å°å‡ºæ¥

å†æ¥çœ‹Aé¡µé¢ï¼š

1. åœ¨Aé¡µé¢ä¹Ÿæœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œå½“ç‚¹å‡»è¿™ä¸ªæŒ‰é’®æ—¶è§¦å‘test()
1. æ‰“å¼€æ–°çª—å£ï¼Œå¹¶å»ºç«‹çª—å£çš„å¼•ç”¨å˜é‡op = window.open('B.html', '_blank');
1. op.addEventListener("message", receiveMessage, false); ç›‘å¬æ–°å¼€çª—å£å‘æ¥çš„æ¶ˆæ¯,é€šè¿‡ receiveMessage() æŠŠæ•°æ®æ‰“å°å‡ºæ¥
#### 3.2.2ã€å¦‚ä½•æ­£ç¡®çš„ä½¿ç”¨ï¼Œä»¥ä¿è¯å®‰å…¨æ€§ï¼Ÿ

1. å§‹ç»ˆä½¿ç”¨originå’Œsourceå±æ€§éªŒè¯å‘ä»¶äººçš„èº«ä»½,æ²¡æœ‰éªŒè¯originå’Œsourceå±æ€§ä¼šå¯¼è‡´è·¨ç«™ç‚¹è„šæœ¬æ”»å‡»ã€‚
1. å½“ä½¿ç”¨postMessageå°†æ•°æ®å‘é€åˆ°å…¶ä»–çª—å£æ—¶ï¼ŒæŒ‡å®šç²¾ç¡®çš„ç›®æ ‡originï¼Œè€Œä¸æ˜¯*
### 3.3ã€JSONP
> JSONP(JSON with Padding)æ˜¯JSONçš„ä¸€ç§â€œä½¿ç”¨æ¨¡å¼â€ï¼Œå¯ç”¨äºè§£å†³ä¸»æµæµè§ˆå™¨çš„è·¨åŸŸæ•°æ®è®¿é—®çš„é—®é¢˜ã€‚

#### 3.3.1ã€JSONPçš„ä»‹ç»
JSONP æ˜¯é€šè¿‡åœ¨`<script></srcipt>`æ ‡ç­¾é‡Œï¼Œé€šè¿‡srcï¼Œimgï¼Œhref å±æ€§çš„è·¨åŸŸæ–¹å¼å‘ä¸€ä¸ªä¸åŒæºçš„ç½‘ç«™åœ°å€å‘é€httpè¯·æ±‚ï¼Œå¹¶ä¸”ä½¿å¾—jsonæ•°æ®å¯ä»¥åœ¨javascriptä»£ç ä¸­èƒ½å¤Ÿä½¿ç”¨ã€‚
å®ƒè§„é¿äº†javascriptä»£ç ä¸­çš„è·¨æºç½‘ç»œè®¿é—®ï¼Œä¹Ÿå°±æ˜¯æ— æ³•ä½¿ç”¨XMLHttpRequestï¼Œfetchè¢«åŒæºæœºåˆ¶ç®¡åˆ°äº†ï¼ˆå¦‚æœä¸åŒæºçš„è¯ï¼‰ã€‚
æå‰å‡†å¤‡ä¸€ä¸ªæ¥å£ï¼š`[https://photo.sina.cn/aj/index?page=1&cate=recommend](https://photo.sina.cn/aj/index?page=1&cate=recommend)`ç›´æ¥ç½‘é¡µä¸­æ‰“å¼€ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šæ•°æ®çš„ï¼Œå¦‚ä¸‹å›¾ï¼š
![](https://cdn.nlark.com/yuque/0/2021/png/12821255/1627476525368-cddc3ff7-c4ae-43dd-9454-362c23db8c51.png#align=left&display=inline&height=338&margin=%5Bobject%20Object%5D&originHeight=338&originWidth=738&size=0&status=done&style=none&width=738)
è®©æˆ‘ä»¬å°è¯•åœ¨æœ¬åœ°è¯·æ±‚ä¸€ä¸‹è¿™ä¸ªåœ°å€ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ‹¿åˆ°æ•°æ®ï¼šå› ä¸ºåŒæ–¹åœ°å€å¹¶ä¸æ˜¯åŒæºçš„ï¼Œå› æ­¤è¿™æ ·è¯·æ±‚ä¼šæŠ¥è·¨åŸŸçš„é”™ï¼š
```
<body>
   <script>
        fetch('https://photo.sina.cn/aj/index?page=1&cate=recommend')
            .then(data=>{
                console.log(data);
                
            })
    </script>
</body>
å¤åˆ¶ä»£ç 
```
é€šè¿‡ live-serveræ‰“å¼€æµè§ˆå™¨ï¼Œåœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°æŠ¥é”™äº†ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯ä¸€ä¸ªè·¨åŸŸçš„è¯·æ±‚ï¼š
![](https://cdn.nlark.com/yuque/0/2021/png/12821255/1627476525536-5b038751-0566-4344-8aa9-4a18e20c5b0d.png#align=left&display=inline&height=176&margin=%5Bobject%20Object%5D&originHeight=176&originWidth=661&size=0&status=done&style=none&width=661)
æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹JSONPå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼š
#### 3.3.2ã€jsonp å¦‚ä½•ä½¿ç”¨ï¼ŸåŸç†æ˜¯ä»€ä¹ˆï¼Ÿè¿”å›æ•°æ®æ ¼å¼ï¼Ÿå‰ç«¯æ€ä¹ˆå¤„ç†ï¼Ÿ
è¿˜æ˜¯è¯·æ±‚ä¸Šé¢çš„è¿™ä¸ªç½‘ç«™åœ°å€ï¼Œæˆ‘ä»¬æŠŠä»£ç æ”¹æˆä¸‹é¢è¿™æ ·ï¼š
```
<body>
  <script>
    function callback(data){
        console.log(data);
    }
</script>
<script src="https://photo.sina.cn/aj/index?page=1&cate=recommend&callback=callback"></script>  
</body>
å¤åˆ¶ä»£ç 
```
å†æ¥çœ‹çœ‹é¡µé¢æ§åˆ¶å°è¾“å‡ºï¼š
![](https://cdn.nlark.com/yuque/0/2021/png/12821255/1627476525347-2c00c41b-f2cb-400b-8f93-943033df2258.png#align=left&display=inline&height=164&margin=%5Bobject%20Object%5D&originHeight=164&originWidth=435&size=0&status=done&style=none&width=435)
dataæˆåŠŸå–åˆ°äº†ã€‚ä½†æ˜¯æˆ‘ä»¬çš„æ•°æ®åˆ°è¾¾ä¹‹åæ˜¯jsonæ•°æ®ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œscriptæ ‡ç­¾æ˜¯ä¸€ä¸ªåŠ è½½èµ„æºçš„æ ‡ç­¾ï¼Œå®ƒå¹¶ä¸èƒ½ç›´æ¥è¿è¡Œè¿™ä¸ªä»£ç ã€‚
äº‹å®ä¸Šæˆ‘ä»¬æ˜¯åœ¨è®¿é—®çš„æ—¶å€™ï¼Œåœ¨è¯·æ±‚çš„åœ°å€åé¢åŠ ä¸Šä¸€ä¸ªï¼Œ`&callback=callback`ï¼Œé€šçŸ¥æœåŠ¡å™¨ï¼Œæœ¬åœ°æƒ³è¿›è¡Œä¸€ä¸ªè·¨èµ„æºè®¿é—®ï¼ˆä»¥JSOPçš„å½¢å¼è¿›è¡Œè·¨åŸŸï¼‰ã€‚ç­‰å·åé¢çš„`callback`æ˜¯ä¸€ä¸ªä½ è‡ªå·±å®šä¹‰çš„å‡½æ•°ï¼Œåå­—å¯è‡ªå–ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯ï¼Œé€šçŸ¥æˆ‘éœ€è¦è¯·æ±‚çš„åœ°å€ï¼Œè¿™è¾¹é¡µé¢ä¸Šæˆ‘æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¼šç­‰å¾…è°ƒç”¨ï¼Œç”¨æ¥æ‰§è¡Œä½ å‘è¿‡æ¥çš„æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯å¯ä»¥å»æ‰§è¡ŒæŠŠæ•°æ®è¯·æ±‚ä¸‹æ¥çš„æ“ä½œï¼‰ã€‚
å› æ­¤åœ¨æ•°æ®åˆ°è¾¾ä¹‹åï¼Œè¿˜åŒ…äº†ä¸€å±‚å‡½æ•° `callback({data})`ï¼Œå½“æ•°æ®é€šè¿‡scriptæ ‡ç­¾è¯·æ±‚ä¸‹æ¥ä¹‹åï¼Œå†é€šè¿‡`callback`å®ç°äº†ä¸€ä¸ªè°ƒç”¨æœ¬åœ°èµ„æºçš„èƒ½åŠ›ã€‚
![](https://cdn.nlark.com/yuque/0/2021/png/12821255/1627476525344-33e331c3-8492-4f88-ae69-3b4b0cc40788.png#align=left&display=inline&height=299&margin=%5Bobject%20Object%5D&originHeight=299&originWidth=918&size=0&status=done&style=none&width=918)
æœ€åå†ç†ä¸€ä¸‹è¿™éƒ¨åˆ†çš„å†…å®¹ï¼š

- JSONPçš„åŸç†

scriptæ ‡ç­¾è¯·æ±‚æ•°æ®ï¼Œåœ¨è¯·æ±‚çš„åœ°å€åé¢åŠ ä¸Šä¸€ä¸ªï¼Œ`&callback=callback`ï¼Œè¯·æ±‚çš„æœåŠ¡å™¨å°±åœ¨jsonæ•°æ®å¤–é¢åŒ…ä¸€å±‚callbackå‡½æ•°ï¼Œå½“è¿™ä¸ªå¸¦æœ‰æ•°æ®çš„callbackå‡½æ•°å¯ä»¥åœ¨scriptå¾—åˆ°ä¹‹åå¯ä»¥è¿è¡Œçš„å‡½æ•°ï¼š
![](https://cdn.nlark.com/yuque/0/2021/png/12821255/1627476525514-3373e359-bea5-4f9e-bd8b-e21fa3f0d033.png#align=left&display=inline&height=214&margin=%5Bobject%20Object%5D&originHeight=214&originWidth=1204&size=0&status=done&style=none&width=1204)

- è¿”å›çš„æ•°æ®æ ¼å¼

JSON

- ä»¥åŠå‰ç«¯å¦‚ä½•å¤„ç†çš„

JSON with padding --- `callback({data})`
#### 3.3.3ã€è‡ªå·±å°è£…ä¸€ä¸ªjsonpï¼Ÿ

1. å‡†å¤‡å·¥ä½œ
```
<script>
    let jsonp = () => {
    }
    jsonp('https://photo.sina.cn/aj/index', {
      page: 1,
      cate: 'recommend'
    })
    .then(response => {
      console.log(response,'è°ƒç”¨æˆåŠŸå•¦');
    })
  </script>
å¤åˆ¶ä»£ç 
```

2. å…·ä½“å®ç°æµç¨‹
- ç¡®å®šä¼ é€’å‚æ•°ï¼š url ã€æºå¸¦çš„å‚æ•° ã€callback;
- å¤„ç†urlä¸Šçš„å‚æ•°ï¼ˆï¼Ÿåé¢çš„ï¼‰;
- å‡†å¤‡å¥½urlï¼ˆæºå¸¦callbackå‡½æ•°ï¼‰;
- æ„å»ºscriptæ ‡ç­¾;
- æŠŠè¿™ä¸ªæ ‡ç­¾æŒ‚åˆ°windowä¸Š
```
<script>
    // 1ã€ç¡®å®šå¥½å‚æ•°
    let jsonp = (url,data = {},callback = 'callback') => {
    // 2ã€å¤„ç†å¥½urlé‡Œé¢çš„å‚æ•°
      let dataStr = url.indexOf('?') === -1 ? '?':'&'
    // 3ã€æŠŠå‚æ•°å’Œ&æ‹¼æ¥ä¸Šå»
      for (let key in data) {
        dataStr += `${key}=${data[key]}&`;
      }
    // 4ã€æŠŠcallbackæ‹¼æ¥ä¸Š
      dataStr += 'callback=' + callback;
    // 5ã€åˆ›å»ºä¸€ä¸ªscriptæ ‡ç­¾
      let oScript = document.createElement('script');
      oScript.src = url + dataStr;
      document.body.appendChild(oScript);
     // 6ã€æŠŠscriptæ ‡ç­¾æŒ‚è½½åˆ°windowä¸Šå»
    //æ–¹æ¡ˆä¸€ã€
      // window[callback] = (data) => {
      //   console.log(data);
      // }
    // æ–¹æ¡ˆäºŒã€
      return new Promise((reslove,reject) => {
        window[callback] = (data) => {
          try {
            reslove(data)
          } catch(e) {
            reject(e)
          } finally {
            oScript.parentNode.removeChild(oScript);
            //åˆ é™¤è¿™ä¸ªscriptèŠ‚ç‚¹
          }
        }
      })
    }
    //è°ƒç”¨jsonpæ–¹æ³•
    jsonp('https://photo.sina.cn/aj/index?a=1', {
      page: 1,
      cate: 'recommend'
    })
    .then(response => {
      console.log(response,'è°ƒç”¨æˆåŠŸå•¦');
    })
  </script>
å¤åˆ¶ä»£ç 
```
#### 3.3.4ã€å®ç°ä¸€ä¸ªjsonpæœåŠ¡å™¨ç«¯ï¼Ÿï¼ˆnodeç‰ˆæœ¬ï¼Œexpressç‰ˆæœ¬ï¼‰
#### nodeç‰ˆæœ¬
åˆ›å»ºä¸€ä¸ªç»“æ„å¦‚ä¸‹çš„æœåŠ¡å™¨ç«¯æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬å°†åœ¨index.jsä¸­å®ç°æˆ‘ä»¬çš„JSONPï¼š![](https://cdn.nlark.com/yuque/0/2021/png/12821255/1627476525593-f5432324-2aea-48c2-88df-e3c05964cd98.png#align=left&display=inline&height=203&margin=%5Bobject%20Object%5D&originHeight=203&originWidth=373&size=0&status=done&style=none&width=373)
```
var http = require('http');
http.createServer(function(req, res){
// req url  callback=?
console.log(req.url);
let data = {a: 1};
res.writeHead(200, {'Content-type' : 'text/json'})
  const reg = /callback=([\w]+)/
  if (reg.test(req.url)) {
    let padding = RegExp.$1
    res.end(`${padding}(${JSON.stringify(data)})`)
  } else {
    res.end(JSON.stringify(data));
  }
//  res.end('<p>Hello World</p>');
 res.end(JSON.stringify(data));
}).listen(3000);
å¤åˆ¶ä»£ç 
```
#### express ç‰ˆæœ¬
```
var express = require('express');
var cors = require('cors');//åç«¯cors ä¸­é—´ä»¶
const app = express();
app.use(cors());
app.get('/product',(req,res)=>{
    res.json({
        a:1,
        b:2
    })
})
app.listen(8000,()=>{
    console.log('server is ok')
})
å¤åˆ¶ä»£ç 
```
### 3.4 cors
#### 3.4.1ã€ä»‹ç»ä¸€ä¸‹corsï¼Ÿ
> CORSæ˜¯ä¸€ä¸ªW3Cæ ‡å‡†ï¼Œå…¨ç§°æ˜¯"è·¨åŸŸèµ„æºå…±äº«"ï¼ˆCross-origin resource sharingï¼‰ã€‚å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡ºXMLHttpRequestè¯·æ±‚ï¼Œä»è€Œå…‹æœäº†AJAXåªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚

#### 3.4.2ã€ç®€å•è¯·æ±‚å’Œéç®€å•è¯·æ±‚ï¼Ÿ
æµè§ˆå™¨å°†CORSè¯·æ±‚åˆ†æˆä¸¤ç±»ï¼šç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰å’Œéç®€å•è¯·æ±‚ï¼ˆnot-so-simple requestï¼‰ã€‚
é™¤äº†ç®€å•è¯·æ±‚å…¶ä»–çš„éƒ½æ˜¯éç®€å•è¯·æ±‚ï¼Œå› æ­¤åªè¦è®°ä½å“ªäº›æ˜¯ç®€å•è¯·æ±‚å°±å¯ä»¥å•¦ï¼š
#### ç®€å•è¯·æ±‚ï¼šï¼ˆéœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸¤ç§æ¡ä»¶ï¼‰

1. è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š
- HEAD
- GET
- POST
2. HTTPçš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š
- Acceptï¼šè®¾ç½®æ¥å—çš„å†…å®¹ç±»å‹ï¼ˆè¯·æ±‚å¤´ï¼‰
- Accept-Languageï¼šè®¾ç½®æ¥å—çš„è¯­è¨€ï¼ˆè¯·æ±‚å¤´ï¼‰
- Content-Languageï¼šä¸ºå°é—­å†…å®¹è®¾ç½®è‡ªç„¶è¯­è¨€æˆ–è€…ç›®æ ‡ç”¨æˆ·è¯­è¨€ï¼ˆå“åº”å¤´ï¼‰
- Content-Typeï¼šï¼ˆè®¾ç½®è¯·æ±‚ä½“çš„MIMEç±»å‹ï¼ˆé€‚ç”¨POSTå’ŒPUTè¯·æ±‚ï¼‰ï¼‰åªé™äºä¸‰ä¸ªå€¼

`application/x-www-form-urlencoded`ï¼š 
ä¸­é»˜è®¤çš„encTypeï¼Œformè¡¨å•æ•°æ®è¢«ç¼–ç ä¸ºkey/valueæ ¼å¼å‘é€åˆ°æœåŠ¡å™¨ï¼ˆè¡¨å•é»˜è®¤çš„æäº¤æ•°æ®çš„æ ¼å¼ï¼‰
`multipart/form-data`ï¼šå°†è¡¨å•çš„æ•°æ®å¤„ç†ä¸ºä¸€æ¡æ¶ˆæ¯ï¼Œä»¥æ ‡ç­¾ä¸ºå•å…ƒï¼Œç”¨åˆ†éš”ç¬¦åˆ†å¼€ã€‚æ—¢å¯ä»¥ä¸Šä¼ é”®å€¼å¯¹ï¼Œä¹Ÿå¯ä»¥ä¸Šä¼ æ–‡ä»¶ã€‚
`text/plain`ï¼štext/plain ï¼šçº¯æ–‡æœ¬æ ¼å¼
#### 3.4.3ã€é¡¹ç›®ä¸­æ€ä¹ˆä½¿ç”¨ï¼Ÿ

- æœåŠ¡å™¨ç«¯ï¼š
```
const express = require('express');
const app= express();
 
app.get('/', (req, res)=>{
  console.log('server is OK');
  res.end('jingjing')
});
// app.use((req, res, next) => {
// 	res.header("Access-Control-Allow-Origin",'http://localhost:5500');
// 	res.header("Access-Control-Allow-Credentials", true);
// 	res.header("Access-Control-Allow-Headers", 'Content-Type,Content-Length,Authorization, Accept,X-Requested-With');
// 	res.header("Access-Control-Allow-Methods", 'PUT,POST,GET,DELETE,OPTIONS,HEAD');
// 	req.method === 'OPTIONS' ? res.send('CURRENT SERVICES SUPPORT CROSS DOMAIN REQUESTS!') : next();
// });
app.listen(8081, ()=>{
    console.log('Server is running at http://localhost:8081')
})
å¤åˆ¶ä»£ç 
```

- å‰ç«¯è¯·æ±‚ï¼š
```
<body>
    <button onclick="sendAjax()">sendAjax</button>
  <script type="text/javascript">
    var sendAjax = () => {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', 'http://127.0.0.1:5500', true);
        xhr.send();
        xhr.onreadystatechange = function (e) {
          if (xhr.readyState == 4 && xhr.status == 200) {
            console.log(xhr.responseText);
            console.log('æˆåŠŸäº†')
          }
        };
    }
  </script>
  </body>
å¤åˆ¶ä»£ç 
```
è·¨åŸŸæŠ¥é”™ï¼š
![](https://cdn.nlark.com/yuque/0/2021/png/12821255/1627476525349-c6be7ca9-88e6-4ba1-aae9-ba13030fa655.png#align=left&display=inline&height=324&margin=%5Bobject%20Object%5D&originHeight=324&originWidth=909&size=0&status=done&style=none&width=909)
æŠŠä¸­é—´æ³¨é‡Šçš„éƒ¨åˆ†æ”¾å¼€å†æ‰§è¡Œï¼šæ²¡æœ‰ä¸Šé¢çš„æŠ¥é”™äº†ï¼Œä¹Ÿè¿”å›äº†
```
console.log(xhr.responseText);
console.log('æˆåŠŸäº†')
å¤åˆ¶ä»£ç 
```
![](https://cdn.nlark.com/yuque/0/2021/png/12821255/1627476525520-dd68f889-2e62-4bf8-a0fd-a3c3399aa7bd.png#align=left&display=inline&height=189&margin=%5Bobject%20Object%5D&originHeight=189&originWidth=295&size=0&status=done&style=none&width=295)
åˆ†æä¸€ä¸‹ï¼š

- "Access-Control-Allow-Origin",`http://localhost:5500`ï¼š

å¦‚æœæœåŠ¡ç«¯ä»…å…è®¸æ¥è‡ª `http://localhost:5500`çš„è®¿é—®ï¼Œå¦‚æœæœåŠ¡ç«¯è¿”å›çš„ Access-Control-Allow-Origin: * è¡¨æ˜ï¼Œè¯¥èµ„æºå¯ä»¥è¢«ä»»æ„å¤–åŸŸè®¿é—®ã€‚

- "Access-Control-Allow-Credentials", true):

Access-Control-Allow-Credentials å¤´æŒ‡å®šäº†å½“æµè§ˆå™¨çš„credentialsè®¾ç½®ä¸ºtrueæ—¶æ˜¯å¦å…è®¸æµè§ˆå™¨è¯»å–responseçš„å†…å®¹ã€‚

- "Access-Control-Allow-Headers", 'Content-Type,Content-Length,Authorization, Accept,X-Requested-With'):

é¦–éƒ¨å­—æ®µ Access-Control-Allow-Headers è¡¨æ˜æœåŠ¡å™¨å…è®¸è¯·æ±‚ä¸­æºå¸¦å­—æ®µ X-PINGOTHER ä¸ Content-Typeã€‚

- "Access-Control-Allow-Methods", 'PUT,POST,GET,DELETE,OPTIONS,HEAD':

é¦–éƒ¨å­—æ®µ Access-Control-Allow-Methods è¡¨æ˜æœåŠ¡å™¨å…è®¸å®¢æˆ·ç«¯ä½¿ç”¨ POST, GET å’Œ OPTIONS ç­‰æ–¹æ³•å‘èµ·è¯·æ±‚

- req.method === 'OPTIONS' ? res.send('CURRENT SERVICES SUPPORT CROSS DOMAIN REQUESTS!') : next():

â€œéœ€é¢„æ£€çš„è¯·æ±‚â€è¦æ±‚å¿…é¡»é¦–å…ˆä½¿ç”¨ OPTIONS   æ–¹æ³•å‘èµ·ä¸€ä¸ªé¢„æ£€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œä»¥è·çŸ¥æœåŠ¡å™¨æ˜¯å¦å…è®¸è¯¥å®é™…è¯·æ±‚(é™¤ç®€å•è¯·æ±‚ä»¥å¤–çš„ï¼Œæ¯”å¦‚ POSTæ–¹æ³•å°±éœ€è¦ç”¨åˆ°é¢„æ£€)
### 3.5ã€ä»£ç† ï¼ˆnginxï¼‰
#### 3.5.1 åŸç†
Aç½‘ç«™å‘Bç½‘ç«™è¯·æ±‚1.jsæ–‡ä»¶æ—¶ï¼Œå‘Bç½‘ç«™å‘é€ä¸€ä¸ªè·å–çš„è¯·æ±‚ï¼Œnginxæ ¹æ®é…ç½®æ–‡ä»¶æ¥æ”¶è¿™ä¸ªè¯·æ±‚ï¼Œä»£æ›¿Aç½‘ç«™å‘Bç½‘ç«™æ¥è¯·æ±‚è¿™ä¸ªèµ„æºï¼Œnginxæ‹¿åˆ°è¿™ä¸ªèµ„æºåå†è¿”å›ç»™aç½‘ç«™ï¼Œä»¥æ­¤æ¥è§£å†³äº†è·¨åŸŸé—®é¢˜ã€‚
![](https://cdn.nlark.com/yuque/0/2021/png/12821255/1627476525461-89bfe6bf-2283-4953-afa8-9204dec49275.png#align=left&display=inline&height=501&margin=%5Bobject%20Object%5D&originHeight=501&originWidth=1153&size=0&status=done&style=none&width=1153)
#### 3.5.2 ä½¿ç”¨
ä½¿ç”¨Nginxï¼Œæœ‰å…³ä¸‹è½½å’Œé…ç½®Nginxï¼Œæˆ‘å°±ä¸å†è¿™é‡Œè¯´äº†ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å‚è€ƒä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼Œé‡Œé¢é…ç½®ç›¸å…³çš„è®²çš„æ¯”è¾ƒæ¸…æ¥šã€‚[æ­£ç¡®çš„Nginxè·¨åŸŸé…ç½®](https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fenvon123%2Farticle%2Fdetails%2F83270277)
## æ€»ç»“
æœ€åå†æ¥ä¸€æ¬¡æ‹·é—®ï¼š

1. èƒ½è¯´è¯´è·¨åŸŸå—ï¼Ÿ
1. èƒ½è¯´è¯´åŒæºç­–ç•¥å—ï¼Ÿ
1. ä¸ºä»€ä¹ˆè¦åŒæºç­–ç•¥ï¼Œå®ƒé™åˆ¶äº†ä»€ä¹ˆï¼Ÿ
1. ä½ çŸ¥é“å“ªäº›è·¨åŸŸæ–¹æ¡ˆå‘¢ï¼Ÿ
1. æœ‰å…³cookieçš„è·¨åŸŸæ€ä¹ˆå®ç°ï¼Ÿ
1. èƒ½å…·ä½“è¯´è¯´JSONPå—ï¼Ÿè¿”å›ä»€ä¹ˆæ•°æ®å‘¢ï¼Œå‰ç«¯æ€ä¹ˆå¤„ç†å‘¢ï¼ŸçŸ¥é“ä»€ä¹ˆåŸç†å—ï¼Ÿå®ç°è¿‡å—ï¼ŸJSONPæœåŠ¡å™¨ç«¯å®ç°è¿‡å—ï¼Ÿ
1. postMessage äº†è§£å—ï¼Ÿæ€ä¹ˆä½¿ç”¨ï¼Ÿéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿï¼ˆå®‰å…¨æ–¹é¢ï¼‰
1. ä»£ç†äº†è§£è¿‡å—ï¼Ÿç”¨è¿‡å“ªäº›ä»£ç†æ–¹æ¡ˆå‘¢ä¸ï¼Ÿæ€ä¹ˆåœ¨é¡¹ç›®ä¸­ç”¨å‘¢ï¼Ÿ
1. corså¯ä»¥å…·ä½“è¯´ä¸€ä¸ªç®€å•è¯·æ±‚å’Œéç®€å•è¯·æ±‚å—ï¼Ÿå…·ä½“è¿‡ç¨‹è¯´ä¸€ä¸‹ï¼Ÿé¡¹ç›®ä¸­æ€ä¹ˆä½¿ç”¨ï¼Ÿ

ã€å‚è€ƒæ–‡çŒ®ã€‘ï¼š
[è·¨åŸŸèµ„æºå…±äº« CORS è¯¦è§£](https://link.juejin.cn/?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2016%2F04%2Fcors.html)
[æµè§ˆå™¨çš„åŒæºç­–ç•¥](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FSecurity%2FSame-origin_policy)
[æ­£ç¡®çš„Nginxè·¨åŸŸé…ç½®](https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fenvon123%2Farticle%2Fdetails%2F83270277)
[window.postMessageç”¨æ³•](https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_40650646%2Farticle%2Fdetails%2F81777398%3Futm_medium%3Ddistribute.pc_relevant.none-task-blog-2%257Edefault%257EBlogCommendFromBaidu%257Edefault-7.control%26dist_request_id%3D1328769.70653.16176908362791735%26depth_1-utm_source%3Ddistribute.pc_relevant.none-task-blog-2%257Edefault%257EBlogCommendFromBaidu%257Edefault-7.control)
[HTTP Headers](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FHeaders)

å‚è€ƒï¼š[https://juejin.cn/post/6947940375008903176](https://juejin.cn/post/6947940375008903176)


